function preload(){for(var i=0;i<numsounds;i++)file.push(loadSound("assets/"+(i+1)+".ogg"))}function setup(){createCanvas(960,144).parent("game"),rectMode(CENTER),ellipseMode(RADIUS),HALFW=.5*width,HALFH=.5*height,offset=createVector(0,0),point=createVector(HALFW,HALFH),pointR=3;for(var i=5;i>0;i--)spheres.push(new Sphere(createVector(random(width),random(height)),random(MINRAD,MAXRAD),createVector(random(10),random(10)),spheres.length,random(LAYER)));setInterval(soundTimer,10),setInterval(radTimer,10)}function draw(){frameRate(60);for(let i=preview.length-1;i>=0;i--){var prv=preview[i];prv.display(),prv.placement()}for(let i=spheres.length-1;i>=0;i--){var sph=spheres[i];sph.movement(),sph.display(),sph.collision()}if(keyIsDown(37)&&point.x>=pointR&&(point.x-=.5*pointR),keyIsDown(38)&&point.y>=pointR&&(point.y-=.5*pointR),keyIsDown(39)&&point.x<=width-pointR&&(point.x+=.5*pointR),keyIsDown(40)&&point.y<=height-pointR&&(point.y+=.5*pointR,keyIsDown(38)&&++keyTimer>100))for(var i=spheres.length;i>=0;i--)spheres.pop(i);keyIsDown(32)&&(preview.length<=0&&preview.push(new Sphere(createVector(point.x,point.y),radSize,createVector(0,0),preview.length,sphLayer)),shot=createVector(offset.x-point.x,offset.y-point.y)),colorMode(HSB,360,100,100),blendMode(DIFFERENCE),fill(360,1,100),textFont("Open Sans"),textSize(12),text("Spheres: "+spheres.length,10,15),blendMode(BLEND),fill(abs(360*sphLayer/LAYER.length),100,100),ellipse(point.x,point.y,pointR,pointR),fill(360,0,100),rect(HALFW,height,keyTimer*width/100,1),colorMode(RGB,255,255,255,100),blendMode(MULTIPLY),fill(128,TRAIL),rect(HALFW,HALFH,width,height)}function keyPressed(){radSize=MINRAD,32===keyCode&&(offset=createVector(point.x,point.y)),keyIsDown(40)&&keyIsDown(38)&&(spheres.length-1>-1&&spheres.pop(preview.length-1),blendMode(BLEND),colorMode(HSB,360,100,100),fill(360,0,100),rect(HALFW,HALFH,width,height)),keyIsDown(39)&&keyIsDown(37)&&(sphLayer<=LAYER.length+1&&++sphLayer>LAYER.length&&(sphLayer=1),blendMode(BLEND),colorMode(HSB,360,100,100),fill(abs(360*sphLayer/LAYER.length),100,100),rect(HALFW,HALFH,width,height))}function keyReleased(){keyTimer=0,32===keyCode&&(preview.length>0&&preview.pop(preview.length),spheres.length-1<=MAXSPH&&spheres.push(new Sphere(createVector(point.x,point.y),radSize,createVector(shot.x,shot.y),spheres.length,sphLayer)))}function soundTimer(){fCount>0&&fCount--}function radTimer(){radSize<MAXRAD&&keyIsDown(32)?radSize+=.1:radSize=MINRAD}function Sphere(position,radius,velocity,id,layer){var playSound,sphCollision,p=position,r=radius,v=velocity;this.layer=function(){return layer},this.p=function(){return p},this.r=function(){return r},this.v=function(){return v},this.placement=function(){p.set(point.x,point.y),r=radSize,keyIsDown(32)&&(stroke(255),line(point.x,point.y,offset.x,offset.y),noStroke())},this.movement=function(){v.x>r?(v.normalize(),v.mult(r)):v.x<-r&&(v.normalize(),v.mult(r)),v.y>r?(v.normalize(),v.mult(r)):v.y<-r&&(v.normalize(),v.mult(r)),FRICTION>1&&(v.x>0&&(v.x-=abs(v.x)/FRICTION),v.x<0&&(v.x+=abs(v.x)/FRICTION),v.y>0&&(v.y-=abs(v.y)/FRICTION),v.y<0&&(v.y+=abs(v.y)/FRICTION)),p.add(v)},this.display=function(){noStroke(),blendMode(BLEND),colorMode(HSB,360,100,100),fill(abs(360*layer/LAYER.length),100*(abs(v.y)+abs(v.x))/(2*r)+25,100),ellipse(p.x,p.y,r,r)},this.collision=function(){p.x+r>width&&(p.x+=-abs(-width+p.x+r),v.x*=-1,playSound(layer,.5,r/MAXRAD)),p.x-r<0&&(p.x+=abs(p.x-r),v.x*=-1,playSound(layer,1,r/MAXRAD)),p.y+r>height&&(p.y+=-abs(-height+p.y+r),v.y*=-1,playSound(layer,1.5,r/MAXRAD)),p.y-r<0&&(p.y+=abs(p.y-r),v.y*=-1,playSound(layer,2,r/MAXRAD));for(let j=id+1;j<spheres.length;j++){let sphOther=spheres[j];sphCollision(sphOther)}},sphCollision=function(sphOther){if(layer===sphOther.layer()){let pi=p,pj=sphOther.p(),ri=r,rj=sphOther.r(),sumRad=ri+rj,vctBtw=createVector(pi.x-pj.x,pi.y-pj.y),disBtw=vctBtw.mag();if(!(disBtw>sumRad*ri*.6||(colorMode(HSB,360,100,100),stroke(72*layer,100*(abs(v.y)+abs(v.x))/sumRad+10,100),blendMode(BLEND),line(pi.x,pi.y,pj.x,pj.y),noStroke(),disBtw>sumRad-.01))){0!==disBtw||(disBtw=sumRad-1,vctBtw=createVector(0,sumRad)),pi.add(vctBtw),pj.sub(vctBtw);let vi=v,vj=sphOther.v(),dirBtw=vctBtw.normalize(),viM=vi.mag(),vjM=vi.mag();vi.set(dirBtw.mult(-viM)),vj.set(dirBtw.mult(-vjM));let vik=createVector(vi.x,vi.y),vjk=createVector(vj.x,vj.y);vi.set(vjk.sub(vik)),vj.set(vik.sub(vjk)),ellipse(p.x,p.y,.7*sumRad,.7*sumRad),playSound(layer,ri/sumRad*2,(ri+rj)/MAXRAD*2)}}},playSound=function(layer,rate,vol){fCount<20&&(file[layer-1].play(0,rate,vol),fCount++)}}var radSize,HALFW,HALFH,point,pointR,offset,shot,file=[],spheres=[],preview=[],TRAIL=50,MAXSPH=500,MAXRAD=18,MINRAD=3,LAYER=[1,2,3,4,5],sphLayer=1,numsounds=LAYER.length,FRICTION=1e4,fCount=0,keyTimer=0;