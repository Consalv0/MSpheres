function preload(){for(let i=0;i<numsounds;i++)file.push(loadSound("assets/"+(i+1)+".ogg"));UbuntuMono=loadFont("assets/UbuntuMono-Regular.ttf")}function setup(){createCanvas($(window).width(),$(window).height()).parent("game"),rectMode(CENTER),ellipseMode(RADIUS),strokeWeight(2),sphLayer=random(LAYER),HALFW=.5*width,HALFH=.5*height,offset=createVector(0,0),point=createVector(HALFW,HALFH);for(let i=5;i>0;i--)spheres.push(new Sphere(createVector(random(width),random(height)),random(MINRAD,MAXRAD),createVector(random(10),random(10)),spheres.length,random(LAYER)));setInterval(soundTimer,10),setInterval(radTimer,10),setInterval(msgDisplay,6e4)}function draw(){function isActive(){active=!0,(inactivity+=.007*inactivity+inactivity<ACTIVE_TIME?abs(Math.floor(.007*inactivity)):0)<=0&&(inactivity=ACTIVE_TIME)}frameRate(60),msgCount++,active&&((inactivity>0||inactivity<ACTIVE_TIME)&&inactivity--,inactivity<=0&&isInactive());for(let i=0;i<preview.length;i++){var prv=preview[i];prv.display(),prv.placement()}for(let i=0;i<spheres.length;i++){var sph=spheres[i];sph.movement(),sph.display(),sph.collision()}if(keyIsDown(37)&&point.x>=pointR&&(isActive(),point.x-=.5*pointR),keyIsDown(38)&&point.y>=pointR&&(isActive(),point.y-=.5*pointR),keyIsDown(39)&&point.x<=width-pointR&&(isActive(),point.x+=.5*pointR),keyIsDown(40)&&point.y<=height-pointR&&(isActive(),point.y+=.5*pointR,keyIsDown(38)&&++keyTimer>100))for(let i=spheres.length;i>=0;i--)spheres.pop(i);keyIsDown(32)&&(isActive(),preview.length<=0&&preview.push(new Sphere(createVector(point.x,point.y),radSize,createVector(0,0),preview.length,sphLayer)),shot=createVector(offset.x-point.x,offset.y-point.y)),colorMode(HSB,360,100,100),blendMode(SCREEN),fill(100,94,92),textFont(UbuntuMono),textSize(12),text(spheres.length,10,15),textSize(12),domsg&&active&&text(msgInteractivity,10,height-15),domsg&&!active&&text(msgInactivity,10,height-15),blendMode(BLEND),fill(abs(360*sphLayer/LAYER.length),100,100),ellipse(point.x,point.y,pointR,pointR),fill(360,0,100),rect(HALFW,height,keyTimer*width/100,1),fill(0,100,100),rect(HALFW,1,(ACTIVE_TIME-inactivity)*width/ACTIVE_TIME,1),colorMode(RGB,255,255,255,100),blendMode(MULTIPLY),fill(128,TRAIL),rect(HALFW,HALFH,width,height),domsg=!(msgCount>680)&&domsg,msgCount=msgCount>680?0:msgCount}function msgDisplay(){msgInteractivity=txtInteractivity[Math.floor(random(0,txtInteractivity.length))],msgInactivity=txtInactivity[Math.floor(random(0,txtInactivity.length))],domsg=!0,msgCount=0}function keyPressed(){active=!0,radSize=MINRAD,32===keyCode&&(offset=createVector(point.x,point.y)),keyIsDown(40)&&keyIsDown(38)&&(spheres.length-1>-1&&spheres.pop(preview.length-1),blendMode(BLEND),colorMode(HSB,360,100,100),fill(360,0,100),rect(HALFW,HALFH,width,height)),keyIsDown(39)&&keyIsDown(37)&&(sphLayer<=LAYER.length+1&&++sphLayer>LAYER.length&&(sphLayer=1),blendMode(BLEND),colorMode(HSB,360,100,100),fill(abs(360*sphLayer/LAYER.length),100,100),rect(HALFW,HALFH,width,height))}function keyReleased(){keyTimer=0,32===keyCode&&(preview.length>0&&preview.pop(preview.length),spheres.length-1<=MAXSPH&&spheres.push(new Sphere(createVector(point.x,point.y),radSize,createVector(shot.x,shot.y),spheres.length,sphLayer)))}function soundTimer(){sCount>0&&sCount--}function radTimer(){radSize<MAXRAD&&keyIsDown(32)?radSize+=.1:radSize=MINRAD}function Sphere(position,radius,velocity,id,layer){var playSound,sphCollision,p=position,r=radius,v=velocity;this.layer=function(){return layer},this.p=function(){return p},this.r=function(){return r},this.v=function(){return v},this.placement=function(){p.set(point.x,point.y),r=radSize,keyIsDown(32)&&(stroke(255),line(point.x,point.y,offset.x,offset.y),noStroke())},this.movement=function(){v.x>r?(v.normalize(),v.mult(r)):v.x<-r&&(v.normalize(),v.mult(r)),v.y>r?(v.normalize(),v.mult(r)):v.y<-r&&(v.normalize(),v.mult(r)),FRICTION>1&&(v.x>0&&(v.x-=abs(v.x)/FRICTION),v.x<0&&(v.x+=abs(v.x)/FRICTION),v.y>0&&(v.y-=abs(v.y)/FRICTION),v.y<0&&(v.y+=abs(v.y)/FRICTION)),active&&p.add(v)},this.display=function(){noStroke(),blendMode(BLEND),colorMode(HSB,360,1,1,1),fill(72*layer,(abs(v.y)+abs(v.x))/(r+r)+.25,1,1),ellipse(p.x,p.y,r,r)},this.collision=function(){p.x+r>width&&(p.x+=-abs(-width+p.x+r),v.x*=-1,playSound(layer,1,r/MAXRAD)),p.x-r<0&&(p.x+=abs(p.x-r),v.x*=-1,playSound(layer,2,r/MAXRAD)),p.y+r>height&&(p.y+=-abs(-height+p.y+r),v.y*=-1,playSound(layer,3,r/MAXRAD)),p.y-r<0&&(p.y+=abs(p.y-r),v.y*=-1,playSound(layer,4,r/MAXRAD));for(let j=id+1;j<spheres.length;j++){let sphOther=spheres[j];sphCollision(sphOther)}},sphCollision=function(sphOther){if(layer===sphOther.layer()){let pi=p,pj=sphOther.p(),ri=r,rj=sphOther.r(),sumRad=ri+rj,vctBtw=createVector(pi.x-pj.x,pi.y-pj.y),disBtw=vctBtw.mag(),webDist=8*sumRad;if(!(disBtw>webDist||(stroke(72*layer,(abs(v.y)+abs(v.x))/sumRad+.1,1,(webDist-disBtw)/webDist),line(pi.x,pi.y,pj.x,pj.y),noStroke(),disBtw>sumRad-.01))){0!==disBtw||(disBtw=sumRad-1,vctBtw=createVector(0,sumRad)),pi.add(vctBtw),pj.sub(vctBtw);let vi=v,vj=sphOther.v(),dirBtw=vctBtw.normalize(),vik=createVector(vi.x,vi.y),vjk=createVector(vj.x,vj.y);vi.set(vik.add(vjk)),vj.set(vjk.add(vik));let viM=vi.mag(),vjM=vj.mag();vi.set(dirBtw.mult(viM)),vj.set(dirBtw.mult(-vjM)),ellipse(p.x,p.y,.7*sumRad,.7*sumRad),playSound(layer,ri/sumRad*2,ri/MAXRAD)}}},playSound=function(layer,rate,vol){sCount<20&&(file[layer-1].play(0,rate),file[layer-1].setVolume(vol),sCount++)}}function isInactive(){active=!1;for(let i=spheres.length;i>5;i--)spheres.pop(i)}var HALFW,HALFH,sphLayer,radSize,point,offset,shot,msgInteractivity,msgInactivity,UbuntuMono,file=[],spheres=[],preview=[],TRAIL=50,MAXSPH=500,MAXRAD=18,MINRAD=3,LAYER=[1,2,3,4,5],FRICTION=1e4,ACTIVE_TIME=12e3,numsounds=LAYER.length,pointR=3,sCount=0,keyTimer=0,msgCount=0,inactivity=ACTIVE_TIME,domsg=!1,active=!0;let txtInactivity=["¿Hay alguien?","¿Sigues ahí?","Hum, parece que ya no hay nadie...","Tururu?","Parece que no hay nadie...","Oye, ¿Sigues ahí?","¿Alo?","Parece que estoy sola de nuevo...","Puedes mover las flechas para mover el puntero..."],txtInteractivity=["Puedes mover las flechas para mover el puntero.","Si aprietas las flechas arriba y abajo puedes eliminar esferas.","¿Haz intentado presionar todas las teclas al mismo tiempo?","¡Suelta la barra espaciadora para lanzar la esfera!","Si aprietas las flechas laterales cabias la capa.","¿Haz notado que el punto que controlas cambia de color?","¿Y si intentas hacer que suene bien?","Hum, no suena mal...","Me gusta como suena C:","Esa esfera parece que no chocó bien..., tendré que checar mi código.","¿Vienes aquí amenudo?","¿Ya viste el horario?, parece interesante","Ya, deja jugar a los demás","¿Si le sabes?","Jajaja, ¿a eso le llamas música?","Prueba con algo más sencillo","Woa, parecen mini telarañas","¿Alo polsia?","¿Y que tan grande se ve la esfera?","Hum...",":C","C:","¿Qué tal?","...","¿Haz intentado mantener la barra espaciadora abajo?","Pst: Me agradas","Pst: ¿Te gusta hora de aventura?","Plop, plip, plop","Buena idea, suena mejor así"];